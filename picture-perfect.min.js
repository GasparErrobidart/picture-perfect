function PicturePerfect(img){for(var picture=img.parentElement,maxWindowSize=window.innerWidth,sources=[],bgWrapper=img.closest("bg-image-wrapper"),container,i=0;i<picture.childNodes.length;i++){var node=picture.childNodes[i];node.tagName&&"SOURCE"==node.tagName&&sources.push({dom:node,format:node.getAttribute("type").replace("image/",""),originalSrcset:node.getAttribute("srcset")||"",originalDataSrcset:node.getAttribute("data-srcset")||""})}var proximityThreshold=window.innerHeight/2;try{proximityThreshold=eval(picture.getAttribute("data-threshold"))||proximityThreshold}catch(e){console.log(e)}var automaticSizes="false"!==picture.getAttribute("data-automatic-sizes")||!0,automaticSrcset="false"!==picture.getAttribute("data-automatic-srcset")||!0,densities=(picture.getAttribute("data-densities")||"1").split(",").map(function(e){return parseFloat(e)}),url=picture.getAttribute("data-dynamic-url")||"";function handPickSizeFor(){return Math.ceil(img.getBoundingClientRect().width/window.innerWidth*100)+"vw"}function setElementSizes(e){picture.childNodes.forEach(function(e){e.tagName&&-1<["SOURCE","IMG"].indexOf(e.tagName)&&e.setAttribute("sizes",handPickSizeFor())})}function updateSources(){var r=Math.ceil(img.getBoundingClientRect().width);r<=0&&(r=100),sources.forEach(function(e){var i=e.format,t=[];url&&automaticSrcset&&(t=densities.map(function(e){var t=Math.ceil(r*e);return url.replace(/\$\{format\}/gi,i.replace(/jpeg/gi,"jpg")).replace(/\$\{width\}/gi,t)+" "+t+"w"})),e.originalSrcset&&t.push(e.originalSrcset),e.originalDataSrcset&&t.push(e.originalDataSrcset),e.dom.setAttribute("srcset",t.join(","))})}function simulateBG(e){if(!(container=container||e.closest(".mimic-background-container")))return!1;if(bgWrapper){picture.getAttribute("data-mimic-background"),bgWrapper.style.backgroundSize,bgWrapper.style.backgroundSize;var t="center",i="center",r=bgWrapper.style.backgroundPosition.split(" ");2<r.length&&(-1<["left","center","right"].indexOf(r[0])&&(t=r[0]),-1<["top","center","bottom"].indexOf(r[1])&&(i=r[1]),-1<r[0].indexOf("px")&&(t=parseInt(r[0].replace("px"))),-1<r[1].indexOf("px")&&(i=parseInt(r[1].replace("px"))));var n=container.getBoundingClientRect(),o=e.getBoundingClientRect();e.style.marginLeft="number"==typeof t?t+"px":"left"==t?"0px":"right"==t?n.width-o.width+"px":(n.width-o.width)/2+"px",e.style.marginTop="number"==typeof i?i+"px":"left"==i?"0px":"right"==i?n.height-o.height+"px":(n.height-o.height)/2+"px"}}var onResize=function(){automaticSizes&&setElementSizes(img),mimicBackground&&simulateBG(img),maxWindowSize<window.innerWidth&&(maxWindowSize=window.innerWidth,updateSources())},onLoad=function(){mimicBackground&&simulateBG(img)},onProximity=function(){var e;automaticSizes&&setElementSizes(),mimicBackground&&simulateBG(img),updateSources(),window.addEventListener("resize",function(){clearTimeout(e),e=setTimeout(onResize,100)}),img.addEventListener("load",onLoad)},onScroll=function(){img.getBoundingClientRect().top-window.innerHeight<proximityThreshold&&(onProximity(),window.removeEventListener("scroll",onScroll))};window.addEventListener("scroll",onScroll),onScroll()}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var JIT_PICTURE_PERFECT=function(e){new PicturePerfect(e),e.onload=null};