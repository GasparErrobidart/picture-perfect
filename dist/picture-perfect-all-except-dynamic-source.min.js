function PicturePerfect(e,i){var t=this;i=i||{},t.options=i,t.img=e,t.img.className=t.img.className+=" picture-perfect",t.initialized=!(0!=i.lazy&&t.lazyLoad),t.maxWindowSize=window.innerWidth,t._calculateSizes=function(){0!=i.calculateSize&&t.setElementSize&&t.setElementSize(e)},t._updateSources=function(){0!=i.dynamicSources&&t.updateSources&&t.updateSources(t.img)},t._mimicBackgroundImage=function(){0!=i.mimicBackgroundImage&&t.mimicBackgroundImage&&t.mimicBackgroundImage(t.img)},t.onProximity=function(){t.initialized&&(t.img.className=t.img.className+=" picture-perfect-ready",t.img.addEventListener("load",t.onLoad),window.addEventListener("resize",function(){setTimeout(t.onResize,100)}),t._calculateSizes(),t._updateSources(),t._mimicBackgroundImage())},t.onResize=function(){t.maxWindowSize<window.innerWidth&&(t.maxWindowSize=window.innerWidth,t._updateSources()),t._calculateSizes(),t._mimicBackgroundImage()},t.onLoad=function(e){t._mimicBackgroundImage()},t.initialized?t.onProximity():t.lazyLoad(),t._mimicBackgroundImage(),window.addEventListener("load",function(){t.onProximity()})}var JIT_IMG=function(e,i){new PicturePerfect(e,i),e.onload=null};PicturePerfect.prototype.lazyLoadAttributes=function(e,i){i.forEach(function(i){var t=e.getAttribute("lazy-"+i);"background-image"==i&&t?e.style.backgroundImage='url("'+t+'")':t&&e.setAttribute(i,t)})},PicturePerfect.prototype.lazyLoad=function(){var onScroll,rect,self=this,proximityThreshold=window.innerHeight/2,img=self.img;try{proximityThreshold=eval(img.getAttribute("lazy-threshold"))||proximityThreshold}catch(e){console.log(e)}onScroll=function(){if((rect=img.getBoundingClientRect()).top-window.innerHeight<proximityThreshold){window.removeEventListener("scroll",onScroll);var e=img.parentElement;e&&/picture/gi.test(e.tagName)&&e.childNodes.forEach(function(e){/source/gi.test(e.tagName)&&self.lazyLoadAttributes(e,["src","srcset","background-image"])}),self.lazyLoadAttributes(img,["src","srcset","background-image"]),self.initialized=!0,self.onProximity()}},window.addEventListener("scroll",onScroll),onScroll()},PicturePerfect.prototype.handPickSizeFor=function(e){return Math.ceil(e.getBoundingClientRect().width/window.innerWidth*100)+"vw"},PicturePerfect.prototype.setElementSize=function(e){e.setAttribute("sizes",this.handPickSizeFor(e))},PicturePerfect.prototype.getCurrentSrcSize=function(e,i){var t=new Image;t.onload=function(){i({width:t.width,height:t.height})},t.src=e.currentSrc},PicturePerfect.prototype.mimicBackgroundImage=function(e){var i=e.closest("[mimic-background-image-wrapper]"),t=e.closest("[mimic-background-image-container]");if(!t||!i)return!1;this.getCurrentSrcSize(e,function(o){var n=i.currentStyle||window.getComputedStyle(i),r="cover"==n.backgroundSize,c="contain"==n.backgroundSize,a=t.getBoundingClientRect(),d=o.width/o.height*a.height,l=(o.height,o.width,a.width,a.width),s=a.height,u=d>=a.width;r?(u?l=d:s=o.height/o.width*a.width,e.style.width=u?"auto":"100%",e.style.height=u?"100%":"auto"):c&&(u?s=o.height/o.width*a.width:l=d,e.style.width=u?"100%":"auto",e.style.height=u?"auto":"100%");var g=n.backgroundPosition.split(" "),m=g[0],h=g[1];if(console.log("Bg position",m,h),m.indexOf("px")>-1)e.style.left=m;else if(m.indexOf("%")>-1){var f=parseFloat(m.replace("%",""));e.style.left=(a.width-l)*(f/100)+"px"}else e.style.left=(a.width-l)/2+"px";if(h.indexOf("px")>-1)e.style.top=h;else if(h.indexOf("%")>-1){f=parseFloat(h.replace("%",""));e.style.top=(a.height-s)*(f/100)+"px"}else e.style.top=(a.height-s)/2+"px"})};