function PicturePerfect(e,i){var t=this;i=i||{},t.options=i,t.img=e,t.img.className=t.img.className+=" picture-perfect",t.initialized=!(0!=i.lazy&&t.lazyLoad),t.maxWindowSize=window.innerWidth,t._calculateSizes=function(){0!=i.calculateSize&&t.setElementSize&&t.setElementSize(e)},t._updateSources=function(){0!=i.dynamicSources&&t.updateSources&&t.updateSources(t.img)},t._mimicBackgroundImage=function(){0!=i.mimicBackgroundImage&&t.mimicBackgroundImage&&t.mimicBackgroundImage(t.img)},t.onProximity=function(){t.initialized&&(t.img.className=t.img.className+=" picture-perfect-ready",t.img.addEventListener("load",t.onLoad),window.addEventListener("resize",function(){setTimeout(t.onResize,100)}),t._calculateSizes(),t._updateSources(),t._mimicBackgroundImage())},t.onResize=function(){t.maxWindowSize<window.innerWidth&&(t.maxWindowSize=window.innerWidth,t._updateSources()),t._calculateSizes(),t._mimicBackgroundImage()},t.onLoad=function(e){t._mimicBackgroundImage()},t.initialized?t.onProximity():t.lazyLoad(),t._mimicBackgroundImage(),window.addEventListener("load",function(){t.onProximity()})}var JIT_IMG=function(e,i){new PicturePerfect(e,i),e.onload=null};PicturePerfect.prototype.getDynamicEndpoint=function(e,i){if(e){(i=i||{}).density||(i.density="1");var t=parseFloat(i.density),n=this.img.getBoundingClientRect(),c=Math.ceil(n.width)||100,a=Math.ceil(n.height);return i.rawWidth=n.width,i.rawHeight=n.height,i.width=Math.ceil(c*t),i.height=Math.ceil(a*t),Object.keys(i).forEach(function(t){var n=new RegExp("\\$\\{"+t+"\\}","gi");e=e.replace(n,i[t])}),{url:e,params:i}}},PicturePerfect.prototype.extractDynamicSourceOptions=function(e){var i={dynamicSrcDensity:e.getAttribute("dynamic-src-density")||""+window.devicePixelRatio,dynamicSrc:e.getAttribute("dynamic-src"),dynamicSrcSetDensities:e.getAttribute("dynamic-srcset-densities")||""+window.devicePixelRatio,dynamicSrcSet:e.getAttribute("dynamic-srcset"),dynamicBackgroundImageDensity:e.getAttribute("dynamic-background-url-density")||""+window.devicePixelRatio,dynamicBackgroundImage:e.getAttribute("dynamic-background-image"),mime:(e.getAttribute("type")||"").replace("image/","")};return Object.keys(i).forEach(function(e){i[e]||delete i[e]}),i},PicturePerfect.prototype.updateSources=function(e){var i=this,t=e.parentElement,n={},c=[e];if(t&&/picture/gi.test(t.tagName)){n=i.extractDynamicSourceOptions(t);for(var a=0;a<t.childNodes.length;a++)/source/gi.test(t.childNodes[a].tagName)&&c.push(t.childNodes[a])}c.forEach(function(e){var t=Object.assign({},n,i.extractDynamicSourceOptions(e));if(["dynamicSrc","dynamicBackgroundImage"].forEach(function(n){if(t[n]){var c={density:t[n+"Density"],mime:t.mime},a=i.getDynamicEndpoint(t[n],c);"dynamicSrc"==n?e.setAttribute("src",a.url):e.style.backgroundImage='url("'+a.url+'")'}}),t.dynamicSrcSet){var c=[];t.dynamicSrcSetDensities.split(",").forEach(function(e){var n={density:e,mime:t.mime},a=i.getDynamicEndpoint(t.dynamicSrcSet,n);c.push(a.url+" "+a.params.width+"w")}),e.setAttribute("srcset",c.join(","))}})};