function PicturePerfect(img){for(var picture=img.parentElement,maxWindowSize=window.innerWidth,sources=[],i=0;i<picture.childNodes.length;i++){var node=picture.childNodes[i];node.tagName&&"SOURCE"==node.tagName&&sources.push({dom:node,format:node.getAttribute("type").replace("image/",""),originalSrcset:node.getAttribute("srcset")||"",originalDataSrcset:node.getAttribute("data-srcset")||""})}var proximityThreshold=window.innerHeight/2;try{proximityThreshold=eval(picture.getAttribute("data-threshold"))||proximityThreshold}catch(t){console.log(t)}var automaticSizes="false"==picture.getAttribute("data-automatic-sizes")||!0,automaticSrcset="false"==picture.getAttribute("data-automatic-srcset")||!0,densities=(picture.getAttribute("data-densities")||"1").split(",").map(function(t){return parseFloat(t)}),url=picture.getAttribute("data-dynamic-url")||"";function handPickSizeFor(){return Math.ceil(img.getBoundingClientRect().width/window.innerWidth*100)+"vw"}function setElementSizes(t){picture.childNodes.forEach(function(t){t.tagName&&-1<["SOURCE","IMG"].indexOf(t.tagName)&&t.setAttribute("sizes",handPickSizeFor())})}function updateSources(){var r=Math.ceil(img.getBoundingClientRect().width);sources.forEach(function(t){var i=t.format,e=[];url&&automaticSrcset&&(e=densities.map(function(t){var e=Math.ceil(r*t);return url.replace(/\$\{format\}/gi,i.replace(/jpeg/gi,"jpg")).replace(/\$\{width\}/gi,e)+" "+e+"w"})),t.originalSrcset&&e.push(t.originalSrcset),t.originalDataSrcset&&e.push(t.originalDataSrcset),t.dom.setAttribute("srcset",e.join(","))})}var onResize=function(){automaticSizes&&setElementSizes(img),maxWindowSize<window.innerWidth&&(maxWindowSize=window.innerWidth,updateSources())},onProximity=function(){var t;automaticSizes&&setElementSizes(),updateSources(),window.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(onResize,100)})},onScroll=function(){img.getBoundingClientRect().top-window.innerHeight<proximityThreshold&&(onProximity(),window.removeEventListener("scroll",onScroll))};window.addEventListener("scroll",onScroll),onScroll()}