function PicturePerfect(e){for(var t=e.parentElement,i=window.innerWidth,r=[],n=0;n<t.childNodes.length;n++){var a=t.childNodes[n];a.tagName&&"SOURCE"==a.tagName&&r.push({dom:a,format:a.getAttribute("type").replace("image/",""),originalSrcset:a.getAttribute("srcset")||""})}var o=t.getAttribute("data-threshold")||window.innerHeight/2,c="false"==t.getAttribute("data-automatic-sizes")||!0,d="false"==t.getAttribute("data-automatic-srcset")||!0,u=(t.getAttribute("data-densities")||["1"]).split(",").map(function(t){return parseFloat(t)}),s=t.getAttribute("data-dynamic-url")||new Error("'data-dynamic-url' must be provided.");function l(){t.childNodes.forEach(function(t){t.tagName&&-1<["SOURCE","IMG"].indexOf(t.tagName)&&t.setAttribute("sizes",Math.ceil(e.getBoundingClientRect().width/window.innerWidth*100)+"vw")})}function g(){var n=Math.ceil(e.getBoundingClientRect().width);r.forEach(function(t){var i=t.format,e=u.map(function(t){var e=Math.ceil(n*t);return s.replace(/\$\{format\}/gi,i.replace(/jpeg/gi,"jpg")).replace(/\$\{width\}/gi,e)+" "+e+"w"}).join(",");t.originalSrcset&&(e+=","+t.originalSrcset),t.dom.setAttribute("srcset",e)})}function w(){c&&l(),i<window.innerWidth&&(i=window.innerWidth,d&&g())}var f=function(){e.getBoundingClientRect().top-window.innerHeight<o&&(function(){var t;c&&l(),d&&g(),window.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(w,100)})}(),window.removeEventListener("scroll",f))};window.addEventListener("scroll",f),f()}window.addEventListener("load",function(){document.querySelectorAll("picture > img[make-picture-perfect]").forEach(PicturePerfect)});