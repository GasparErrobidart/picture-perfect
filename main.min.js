function PicturePerfect(e){for(var t=e.parentElement,i=window.innerWidth,r=[],n=0;n<t.childNodes.length;n++){var a=t.childNodes[n];a.tagName&&"SOURCE"==a.tagName&&r.push({dom:a,format:a.getAttribute("type").replace("image/",""),originalSrcset:a.getAttribute("srcset")||"",originalDataSrcset:a.getAttribute("data-srcset")||""})}var o=t.getAttribute("data-threshold")||window.innerHeight/2,c="false"==t.getAttribute("data-automatic-sizes")||!0,d="false"==t.getAttribute("data-automatic-srcset")||!0,s=(t.getAttribute("data-densities")||"1").split(",").map(function(t){return parseFloat(t)}),u=t.getAttribute("data-dynamic-url")||"";function l(){t.childNodes.forEach(function(t){t.tagName&&-1<["SOURCE","IMG"].indexOf(t.tagName)&&t.setAttribute("sizes",Math.ceil(e.getBoundingClientRect().width/window.innerWidth*100)+"vw")})}function g(){var n=Math.ceil(e.getBoundingClientRect().width);r.forEach(function(t){var i=t.format,e=[];u&&d&&(e=s.map(function(t){var e=Math.ceil(n*t);return u.replace(/\$\{format\}/gi,i.replace(/jpeg/gi,"jpg")).replace(/\$\{width\}/gi,e)+" "+e+"w"})),t.originalSrcset&&e.push(t.originalSrcset),t.originalDataSrcset&&e.push(t.originalDataSrcset),t.dom.setAttribute("srcset",e.join(","))})}function f(){c&&l(),i<window.innerWidth&&(i=window.innerWidth,g())}var w=function(){e.getBoundingClientRect().top-window.innerHeight<o&&(function(){var t;c&&l(),g(),window.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(f,100)})}(),window.removeEventListener("scroll",w))};window.addEventListener("scroll",w),w()}window.addEventListener("load",function(){document.querySelectorAll("picture > img[make-picture-perfect]").forEach(PicturePerfect)});